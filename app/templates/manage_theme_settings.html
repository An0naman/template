<!DOCTYPE html>
<html lang="en" data-bs-theme="{{ 'dark' if theme_settings.dark_mode_enabled else 'light' }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ project_name }} - System Theme</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='mobile.css') }}">
    
    <!-- Dynamic Theme CSS -->
    <style id="theme-styles">
        {{ theme_css|safe }}
    </style>
    
    <style>
        :root {
            --content-spacing: 1.5rem;
            --border-radius: 0.75rem;
            --shadow-sm: 0 1px 3px 0 rgb(0 0 0 / 0.1);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --transition-base: all 0.2s ease;
        }

        body {
            background-color: var(--theme-bg-body, var(--bs-body-bg));
            color: var(--theme-text, var(--bs-body-color));
            font-family: var(--bs-font-sans-serif);
            line-height: 1.6;
        }

        .main-container {
            margin: 2rem 0;
        }

        .settings-container {
            background-color: var(--theme-bg-card, var(--bs-body-bg));
            color: var(--theme-text, var(--bs-body-color));
            border: 1px solid var(--theme-border, var(--bs-border-color));
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            padding: var(--content-spacing);
            margin-bottom: 2rem;
        }

        .settings-section {
            background: var(--theme-bg-surface, var(--bs-secondary-bg));
            border: 1px solid var(--theme-border, var(--bs-border-color));
            border-radius: var(--border-radius);
            padding: var(--content-spacing);
            margin-bottom: var(--content-spacing);
            box-shadow: var(--shadow-sm);
            transition: var(--transition-base);
        }

        .settings-section:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }

        .preview-container {
            background: var(--theme-bg-card, var(--bs-body-bg));
            border: 1px solid var(--theme-border, var(--bs-border-color));
            border-radius: var(--border-radius);
            padding: var(--content-spacing);
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 2rem;
            max-height: calc(100vh - 4rem);
            overflow-y: auto;
        }

        .theme-section {
            background: var(--section-bg, var(--theme-bg-surface, var(--bs-secondary-bg)));
            border: var(--section-border, 1px solid var(--theme-border, var(--bs-border-color)));
            border-radius: var(--section-border-radius, var(--border-radius));
            border-image: var(--section-border-image, none);
            padding: var(--section-padding, var(--content-spacing));
            margin-bottom: var(--section-margin-bottom, var(--content-spacing));
            box-shadow: var(--section-shadow, var(--shadow-sm));
            border-left: 4px solid var(--theme-primary, var(--bs-primary));
            transition: var(--transition-base);
            position: relative;
        }

        .theme-section:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .section-header {
            border-bottom: 1px solid var(--theme-border, var(--bs-border-color));
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .section-title {
            color: var(--theme-text, var(--bs-body-color));
            margin: 0;
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-title i {
            color: var(--theme-primary, var(--bs-primary));
        }

        .section-content {
            padding: 0;
        }

        /* Form controls with proper theming */
        .form-control, .form-select {
            background-color: var(--theme-bg-card, var(--bs-body-bg)) !important;
            border-color: var(--theme-border, var(--bs-border-color)) !important;
            color: var(--theme-text, var(--bs-body-color)) !important;
        }

        .form-control:focus, .form-select:focus {
            background-color: var(--theme-bg-card, var(--bs-body-bg)) !important;
            border-color: var(--theme-primary, var(--bs-primary)) !important;
            color: var(--theme-text, var(--bs-body-color)) !important;
            box-shadow: 0 0 0 0.25rem rgba(var(--theme-primary-rgb, 13, 110, 253), 0.25) !important;
        }

        /* Theme selection cards */
        .theme-card {
            border: 2px solid var(--theme-border, var(--bs-border-color));
            border-radius: var(--border-radius);
            padding: 1rem;
            cursor: pointer;
            transition: var(--transition-base);
            background: var(--theme-bg-card, var(--bs-body-bg));
            height: 100%;
        }

        .theme-card:hover {
            border-color: var(--theme-primary, var(--bs-primary));
            box-shadow: 0 2px 8px rgba(var(--theme-primary-rgb, 13, 110, 253), 0.15);
        }

        .theme-card.selected {
            border-color: var(--theme-primary, var(--bs-primary));
            background: rgba(var(--theme-primary-rgb, 13, 110, 253), 0.1);
        }

        .color-swatch {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            border: 1px solid var(--theme-border, var(--bs-border-color));
            display: inline-block;
            margin-right: 0.5rem;
        }

        /* Toggle switch styling */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--theme-border, #ccc);
            transition: 0.4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: var(--theme-bg-card, white);
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--theme-primary, var(--bs-primary));
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Action buttons */
        .btn-theme-primary {
            background: linear-gradient(135deg, var(--theme-primary, #6f42c1), var(--theme-danger, #d63384));
            border: none;
            color: white;
        }

        .btn-theme-primary:hover {
            background: linear-gradient(135deg, var(--theme-primary-hover, #5a3399), var(--theme-danger, #b02a5a));
            color: white;
        }

        /* Responsive layout */
        @media (max-width: 768px) {
            .preview-container {
                position: static;
                max-height: none;
                margin-top: 2rem;
            }
        }

        /* Preview section effects */
        .effect-glow {
            box-shadow: 0 0 20px rgba(var(--theme-primary-rgb, 13, 110, 253), 0.3);
        }

        .effect-gradient {
            background: linear-gradient(135deg, 
                var(--theme-bg-surface, var(--bs-secondary-bg)) 0%, 
                rgba(var(--theme-primary-rgb, 13, 110, 253), 0.05) 100%);
        }

        .pattern-diagonal-lines {
            background-image: linear-gradient(45deg, 
                transparent 0%, 
                transparent 35%, 
                rgba(var(--theme-primary-rgb, 13, 110, 253), 0.1) 35%, 
                rgba(var(--theme-primary-rgb, 13, 110, 253), 0.1) 65%, 
                transparent 65%);
            background-size: 20px 20px;
        }

        .pattern-dots {
            background-image: radial-gradient(circle, rgba(var(--theme-primary-rgb, 13, 110, 253), 0.15) 1px, transparent 1px);
            background-size: 15px 15px;
        }

        .pattern-grid {
            background-image: 
                linear-gradient(rgba(var(--theme-border-rgb, 222, 226, 230), 0.2) 1px, transparent 1px),
                linear-gradient(90deg, rgba(var(--theme-border-rgb, 222, 226, 230), 0.2) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .pattern-zigzag {
            background-image: linear-gradient(135deg, 
                transparent 0%, 
                transparent 25%, 
                rgba(var(--theme-primary-rgb, 13, 110, 253), 0.1) 25%, 
                rgba(var(--theme-primary-rgb, 13, 110, 253), 0.1) 50%, 
                transparent 50%, 
                transparent 75%, 
                rgba(var(--theme-primary-rgb, 13, 110, 253), 0.1) 75%);
            background-size: 25px 25px;
        }

        .pattern-crosshatch {
            background-image: 
                linear-gradient(45deg, rgba(var(--theme-primary-rgb, 13, 110, 253), 0.1) 25%, transparent 25%),
                linear-gradient(-45deg, rgba(var(--theme-primary-rgb, 13, 110, 253), 0.1) 25%, transparent 25%);
            background-size: 30px 30px;
        }

        .pattern-waves {
            background-image: 
                radial-gradient(ellipse 50px 20px at 50% 0%, rgba(var(--theme-primary-rgb, 13, 110, 253), 0.1), transparent),
                radial-gradient(ellipse 50px 20px at 50% 100%, rgba(var(--theme-primary-rgb, 13, 110, 253), 0.1), transparent);
            background-size: 40px 40px;
            background-position: 0 0, 20px 20px;
        }

        .pattern-honeycomb {
            background-image: 
                radial-gradient(circle at 10px 10px, rgba(var(--theme-primary-rgb, 13, 110, 253), 0.1) 2px, transparent 2px),
                radial-gradient(circle at 30px 30px, rgba(var(--theme-primary-rgb, 13, 110, 253), 0.1) 2px, transparent 2px);
            background-size: 40px 40px;
        }

        .pattern-checkers {
            background-image: 
                linear-gradient(45deg, rgba(var(--theme-primary-rgb, 13, 110, 253), 0.08) 25%, transparent 25%),
                linear-gradient(-45deg, rgba(var(--theme-primary-rgb, 13, 110, 253), 0.08) 25%, transparent 25%);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
        }

        .pattern-triangles {
            background-image: 
                linear-gradient(60deg, rgba(var(--theme-primary-rgb, 13, 110, 253), 0.1) 50%, transparent 50%),
                linear-gradient(-60deg, rgba(var(--theme-primary-rgb, 13, 110, 253), 0.1) 50%, transparent 50%);
            background-size: 30px 26px;
        }

        .pattern-stars {
            background-image: 
                radial-gradient(2px 2px at 20px 30px, rgba(var(--theme-primary-rgb, 13, 110, 253), 0.2), transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(var(--theme-primary-rgb, 13, 110, 253), 0.15), transparent),
                radial-gradient(1px 1px at 90px 40px, rgba(var(--theme-primary-rgb, 13, 110, 253), 0.1), transparent);
            background-size: 100px 100px;
        }

        .pattern-circuit {
            background-image: 
                linear-gradient(90deg, rgba(var(--theme-border-rgb, 222, 226, 230), 0.2) 1px, transparent 1px),
                linear-gradient(rgba(var(--theme-border-rgb, 222, 226, 230), 0.2) 1px, transparent 1px),
                radial-gradient(circle at 20px 20px, rgba(var(--theme-primary-rgb, 13, 110, 253), 0.15) 2px, transparent 2px);
            background-size: 40px 40px, 40px 40px, 40px 40px;
        }

        .pattern-noise {
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(var(--theme-primary-rgb, 13, 110, 253), 0.05) 1px, transparent 1px),
                radial-gradient(circle at 75% 25%, rgba(var(--theme-primary-rgb, 13, 110, 253), 0.08) 1px, transparent 1px),
                radial-gradient(circle at 25% 75%, rgba(var(--theme-primary-rgb, 13, 110, 253), 0.06) 1px, transparent 1px),
                radial-gradient(circle at 75% 75%, rgba(var(--theme-primary-rgb, 13, 110, 253), 0.04) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* FULL EMOJI LIBRARY FOR CORNER DECORATIONS */
        .decoration-leaf::before { content: "üçÉ"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-tree::before { content: "üå≤"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-flower::before { content: "üå∏"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-sun::before { content: "‚òÄÔ∏è"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-moon::before { content: "üåô"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-star::before { content: "‚≠ê"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-diamond::before { content: "üíé"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-shield::before { content: "üõ°Ô∏è"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-sword::before { content: "‚öîÔ∏è"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-gem::before { content: "üí†"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-gear::before { content: "‚öôÔ∏è"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-lightning::before { content: "‚ö°"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-circuit::before { content: "üîå"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-code::before { content: "üìã"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-data::before { content: "üíæ"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }

        /* EXPANDED EMOJI LIBRARY - Nature & Weather */
        .decoration-fire::before { content: "üî•"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-rainbow::before { content: "üåà"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-cloud::before { content: "‚òÅÔ∏è"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-snow::before { content: "‚ùÑÔ∏è"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-cactus::before { content: "üåµ"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-rose::before { content: "üåπ"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-mushroom::before { content: "üçÑ"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }

        /* Animals */
        .decoration-cat::before { content: "üê±"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-dog::before { content: "üê∂"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-fox::before { content: "ü¶ä"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-butterfly::before { content: "ü¶ã"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-bee::before { content: "üêù"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-owl::before { content: "ü¶â"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }

        /* Objects & Tools */
        .decoration-rocket::before { content: "üöÄ"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-robot::before { content: "ü§ñ"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-key::before { content: "üîë"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-lock::before { content: "üîí"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-crown::before { content: "üëë"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-trophy::before { content: "üèÜ"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-medal::before { content: "üèÖ"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }

        /* Food & Drink */
        .decoration-coffee::before { content: "‚òï"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-pizza::before { content: "üçï"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-cake::before { content: "üéÇ"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-donut::before { content: "ÔøΩ"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }

        /* Symbols & Shapes */
        .decoration-heart::before { content: "‚ù§Ô∏è"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-peace::before { content: "‚òÆÔ∏è"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-yin-yang::before { content: "‚òØÔ∏è"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-infinity::before { content: "‚ôæÔ∏è"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-check::before { content: "‚úÖ"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-warning::before { content: "‚ö†Ô∏è"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }

        /* Music & Art */
        .decoration-music::before { content: "üéµ"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-palette::before { content: "üé®"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-camera::before { content: "üì∑"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }

        /* Sports & Activities */
        .decoration-soccer::before { content: "‚öΩ"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-basketball::before { content: "üèÄ"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-target::before { content: "üéØ"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }

        /* Tech & Gaming */
        .decoration-computer::before { content: "üíª"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-phone::before { content: "üì±"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-gamepad::before { content: "üéÆ"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-wifi::before { content: "üì∂"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-battery::before { content: "üîã"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }

        /* Faces & Expressions */
        .decoration-smile::before { content: "üòä"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-cool::before { content: "üòé"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-thinking::before { content: "ü§î"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-party::before { content: "ü•≥"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }

        /* Mystical & Magic */
        .decoration-crystal::before { content: "üîÆ"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-magic::before { content: "‚ú®"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-wizard::before { content: "üßô"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-unicorn::before { content: "ü¶Ñ"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }
        .decoration-dragon::before { content: "üêâ"; position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.5; }

        /* Status message styling */
        .status-message {
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
        }

        /* Collapsible sections */
        .collapsible-section {
            transition: max-height 0.3s ease;
            overflow: hidden;
        }

        .collapsible-section.collapsed .collapsible-content {
            max-height: 0;
            padding: 0;
            margin: 0;
            border: none;
            overflow: hidden;
        }

        .collapsible-section .collapsible-content {
            max-height: none;
            transition: max-height 0.3s ease;
        }

        /* Color input groups */
        .color-input-group {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .color-input-group .form-control[type="color"] {
            width: 50px;
            height: 38px;
            padding: 2px;
            border-radius: 0.375rem 0 0 0.375rem;
        }

        .color-input-group .form-control[type="text"] {
            border-radius: 0 0.375rem 0.375rem 0;
            border-left: none;
        }

        /* Bootstrap Component Overrides to ensure theme colors are used */
        .btn-primary {
            background-color: var(--theme-primary, var(--bs-primary)) !important;
            border-color: var(--theme-primary, var(--bs-primary)) !important;
            color: white !important;
        }

        .btn-primary:hover, .btn-primary:focus {
            background-color: var(--theme-primary-hover, var(--theme-primary-darker)) !important;
            border-color: var(--theme-primary-hover, var(--theme-primary-darker)) !important;
        }

        .btn-outline-primary {
            color: var(--theme-primary, var(--bs-primary)) !important;
            border-color: var(--theme-primary, var(--bs-primary)) !important;
        }

        .btn-outline-primary:hover, .btn-outline-primary:focus {
            background-color: var(--theme-primary, var(--bs-primary)) !important;
            border-color: var(--theme-primary, var(--bs-primary)) !important;
            color: white !important;
        }

        .btn-secondary {
            background-color: var(--theme-secondary, var(--bs-secondary)) !important;
            border-color: var(--theme-secondary, var(--bs-secondary)) !important;
        }

        .btn-outline-secondary {
            color: var(--theme-secondary, var(--bs-secondary)) !important;
            border-color: var(--theme-secondary, var(--bs-secondary)) !important;
        }

        .btn-outline-secondary:hover, .btn-outline-secondary:focus {
            background-color: var(--theme-secondary, var(--bs-secondary)) !important;
            border-color: var(--theme-secondary, var(--bs-secondary)) !important;
        }

        .btn-success {
            background-color: var(--theme-success, var(--bs-success)) !important;
            border-color: var(--theme-success, var(--bs-success)) !important;
        }

        .btn-outline-danger {
            color: var(--theme-danger, var(--bs-danger)) !important;
            border-color: var(--theme-danger, var(--bs-danger)) !important;
        }

        .btn-outline-danger:hover, .btn-outline-danger:focus {
            background-color: var(--theme-danger, var(--bs-danger)) !important;
            border-color: var(--theme-danger, var(--bs-danger)) !important;
        }

        /* Badge overrides */
        .badge.bg-primary {
            background-color: var(--theme-primary, var(--bs-primary)) !important;
            color: white !important;
        }

        .badge.bg-secondary {
            background-color: var(--theme-secondary, var(--bs-secondary)) !important;
            color: white !important;
        }

        .badge.bg-success {
            background-color: var(--theme-success, var(--bs-success)) !important;
            color: white !important;
        }

        .badge.bg-warning {
            background-color: var(--theme-warning, var(--bs-warning)) !important;
            color: black !important;
        }

        .badge.bg-danger {
            background-color: var(--theme-danger, var(--bs-danger)) !important;
            color: white !important;
        }

        .badge.bg-info {
            background-color: var(--theme-info, var(--bs-info)) !important;
            color: white !important;
        }

        /* Alert overrides */
        .alert-primary {
            background-color: var(--theme-primary-subtle, rgba(var(--theme-primary-rgb), 0.1)) !important;
            border-color: var(--theme-primary-border, rgba(var(--theme-primary-rgb), 0.2)) !important;
            color: var(--theme-primary-darker, var(--theme-primary)) !important;
        }

        .alert-success {
            background-color: var(--theme-success-subtle, rgba(var(--theme-success-rgb), 0.1)) !important;
            border-color: var(--theme-success-border, rgba(var(--theme-success-rgb), 0.2)) !important;
            color: var(--theme-success-darker, var(--theme-success)) !important;
        }

        .alert-warning {
            background-color: var(--theme-warning-subtle, rgba(var(--theme-warning-rgb), 0.1)) !important;
            border-color: var(--theme-warning-border, rgba(var(--theme-warning-rgb), 0.2)) !important;
            color: var(--theme-warning-darker, var(--theme-warning)) !important;
        }

        .alert-danger {
            background-color: var(--theme-danger-subtle, rgba(var(--theme-danger-rgb), 0.1)) !important;
            border-color: var(--theme-danger-border, rgba(var(--theme-danger-rgb), 0.2)) !important;
            color: var(--theme-danger-darker, var(--theme-danger)) !important;
        }

        /* Table overrides */
        .table-striped > tbody > tr:nth-of-type(odd) > td {
            background-color: var(--theme-bg-surface, var(--bs-tertiary-bg)) !important;
        }

        .table {
            color: var(--theme-text, var(--bs-body-color)) !important;
        }

        .table th {
            border-color: var(--theme-border, var(--bs-border-color)) !important;
            background-color: var(--theme-bg-surface, var(--bs-tertiary-bg)) !important;
        }

        .table td {
            border-color: var(--theme-border, var(--bs-border-color)) !important;
        }
    </style>
</head>
<body>
    <div class="container-fluid main-container">
        <div class="row">
            <!-- Settings Panel -->
            <div class="col-lg-7">
                <div class="settings-container">
                    <!-- Header -->
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h1 class="mb-0">System Theme</h1>
                            <p class="text-muted mb-0">Configure application theme and visual appearance</p>
                        </div>
                        <div>
                            <a href="{{ url_for('maintenance.maintenance_module_page') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i>Back to Settings
                            </a>
                        </div>
                    </div>

                    <!-- Status Messages -->
                    <div id="statusMessage" class="alert d-none status-message" role="alert"></div>

                    <!-- Core Theme Settings -->
                    <div class="settings-section">
                        <h5 class="mb-3" style="color: var(--theme-primary, #6f42c1);">
                            <i class="fas fa-palette me-2"></i>Theme & Mode
                        </h5>
                        
                        <!-- Dark Mode Toggle -->
                        <div class="row align-items-center mb-4">
                            <div class="col-md-8">
                                <h6>Dark Mode</h6>
                                <p class="text-muted mb-0">Switch to dark color scheme for low-light environments</p>
                            </div>
                            <div class="col-md-4 text-end">
                                <label class="switch">
                                    <input type="checkbox" id="darkModeToggle" {{ 'checked' if dark_mode_enabled else '' }}>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>

                        <!-- Automatic Dark Mode -->
                        <div class="row align-items-center mb-4">
                            <div class="col-md-8">
                                <h6>Automatic Day/Night Mode</h6>
                                <p class="text-muted mb-0">Automatically switch themes based on time of day</p>
                            </div>
                            <div class="col-md-4 text-end">
                                <label class="switch">
                                    <input type="checkbox" id="autoDarkModeToggle" {{ 'checked' if auto_dark_mode else '' }}>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>

                        <!-- Time Settings (only visible when auto mode is enabled) -->
                        <div id="autoModeTimeSettings" class="mb-4" style="display: {{ 'block' if auto_dark_mode else 'none' }};">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">
                                        <i class="fas fa-moon me-1"></i>Dark Mode Starts
                                    </label>
                                    <input type="time" class="form-control" id="darkModeStart" value="{{ dark_mode_start or '18:00' }}">
                                    <small class="text-muted">Default: 6:00 PM</small>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">
                                        <i class="fas fa-sun me-1"></i>Light Mode Starts
                                    </label>
                                    <input type="time" class="form-control" id="darkModeEnd" value="{{ dark_mode_end or '06:00' }}">
                                    <small class="text-muted">Default: 6:00 AM</small>
                                </div>
                            </div>
                            <div class="mt-2">
                                <small class="text-info">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Current time: <span id="currentTime"></span> - 
                                    Mode would be: <span id="currentModePreview"></span>
                                </small>
                            </div>
                        </div>

                        <!-- Theme Selection -->
                        <div class="mb-3">
                            <label class="form-label">Color Scheme</label>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="theme-card" data-theme="default" onclick="themeManager.updateSetting('root', 'theme', 'default')">
                                        <div class="d-flex align-items-center mb-2">
                                            <div class="color-swatch" style="background: #0d6efd;"></div>
                                            <div class="color-swatch" style="background: #198754;"></div>
                                            <div class="color-swatch" style="background: #dc3545;"></div>
                                            <h6 class="mb-0 ms-2">Default Blue</h6>
                                        </div>
                                        <small class="text-muted">Classic Bootstrap colors</small>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="theme-card" data-theme="emerald" onclick="themeManager.updateSetting('root', 'theme', 'emerald')">
                                        <div class="d-flex align-items-center mb-2">
                                            <div class="color-swatch" style="background: #10b981;"></div>
                                            <div class="color-swatch" style="background: #059669;"></div>
                                            <div class="color-swatch" style="background: #ef4444;"></div>
                                            <h6 class="mb-0 ms-2">Emerald Green</h6>
                                        </div>
                                        <small class="text-muted">Nature-inspired green palette</small>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="theme-card" data-theme="purple" onclick="themeManager.updateSetting('root', 'theme', 'purple')">
                                        <div class="d-flex align-items-center mb-2">
                                            <div class="color-swatch" style="background: #8b5cf6;"></div>
                                            <div class="color-swatch" style="background: #7c3aed;"></div>
                                            <div class="color-swatch" style="background: #ef4444;"></div>
                                            <h6 class="mb-0 ms-2">Purple</h6>
                                        </div>
                                        <small class="text-muted">Professional purple scheme</small>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="theme-card" data-theme="amber" onclick="themeManager.updateSetting('root', 'theme', 'amber')">
                                        <div class="d-flex align-items-center mb-2">
                                            <div class="color-swatch" style="background: #f59e0b;"></div>
                                            <div class="color-swatch" style="background: #d97706;"></div>
                                            <div class="color-swatch" style="background: #ef4444;"></div>
                                            <h6 class="mb-0 ms-2">Amber</h6>
                                        </div>
                                        <small class="text-muted">Warm amber and gold tones</small>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="theme-card" data-theme="custom" onclick="themeManager.updateSetting('root', 'theme', 'custom')">
                                        <div class="d-flex align-items-center mb-2">
                                            <div class="color-swatch" style="background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);"></div>
                                            <div class="color-swatch" style="background: linear-gradient(45deg, #96ceb4, #ffeaa7, #fab1a0);"></div>
                                            <div class="color-swatch" style="background: linear-gradient(45deg, #a29bfe, #fd79a8, #fdcb6e);"></div>
                                            <h6 class="mb-0 ms-2">Custom</h6>
                                        </div>
                                        <small class="text-muted">Define your own color palette</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Font Size -->
                        <div class="row">
                            <div class="col-md-6">
                                <label for="fontSize" class="form-label">Font Size</label>
                                <select class="form-select" id="fontSize" onchange="themeManager.updateSetting('root', 'fontSize', this.value)">
                                    <option value="small" {{ 'selected' if font_size == 'small' else '' }}>Small (14px)</option>
                                    <option value="normal" {{ 'selected' if font_size == 'normal' or not font_size else '' }}>Normal (16px)</option>
                                    <option value="large" {{ 'selected' if font_size == 'large' else '' }}>Large (18px)</option>
                                    <option value="extra-large" {{ 'selected' if font_size == 'extra-large' else '' }}>Extra Large (20px)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">High Contrast</label>
                                <div class="text-end">
                                    <label class="switch">
                                        <input type="checkbox" id="highContrastToggle" {{ 'checked' if high_contrast_enabled else '' }}>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Section Styling -->
                    <div class="settings-section">
                        <h5 class="mb-3" style="color: var(--theme-primary, #6f42c1);">
                            <i class="fas fa-layer-group me-2"></i>Section Styling
                        </h5>
                        
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="sectionBorderStyle" class="form-label">Border Style</label>
                                <select class="form-select" id="sectionBorderStyle" onchange="themeManager.updateSetting('sectionStyles', 'borderStyle', this.value)">
                                    <option value="none">None (no border)</option>
                                    <option value="thin">Thin (1px solid)</option>
                                    <option value="thick">Thick (4px solid)</option>
                                    <option value="dashed">Dashed (3px dashed)</option>
                                </select>
                            </div>
                            
                            <div class="col-md-4">
                                <label for="sectionSpacing" class="form-label">Spacing</label>
                                <select class="form-select" id="sectionSpacing" onchange="themeManager.updateSetting('sectionStyles', 'spacing', this.value)">
                                    <option value="compact">Compact</option>
                                    <option value="normal">Normal</option>
                                    <option value="spacious">Spacious</option>
                                </select>
                            </div>
                            
                            <div class="col-md-4">
                                <label for="sectionBackground" class="form-label">Background Style</label>
                                <select class="form-select" id="sectionBackground" onchange="themeManager.updateSetting('sectionStyles', 'background', this.value)">
                                    <option value="flat">Flat</option>
                                    <option value="subtle">Subtle</option>
                                    <option value="elevated">Elevated</option>
                                    <option value="glassmorphic">Glassmorphic</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row g-3 mt-1">
                            <div class="col-md-4">
                                <label for="sectionAnimation" class="form-label">Animation</label>
                                <select class="form-select" id="sectionAnimation" onchange="themeManager.updateSetting('sectionStyles', 'animation', this.value)">
                                    <option value="none">None</option>
                                    <option value="fade">Fade In</option>
                                    <option value="slide">Slide Up</option>
                                    <option value="bounce">Bounce In</option>
                                    <option value="pulse">Pulse</option>
                                </select>
                            </div>
                            
                            <div class="col-md-4">
                                <label for="sectionEffect" class="form-label">Visual Effect</label>
                                <select class="form-select" id="sectionEffect" onchange="themeManager.updateSetting('sectionStyles', 'effect', this.value)">
                                    <option value="none">None</option>
                                    <option value="glow">Glow</option>
                                    <option value="shadow">Enhanced Shadow</option>
                                    <option value="gradient">Gradient</option>
                                    <option value="texture">Texture</option>
                                </select>
                            </div>
                            
                            <div class="col-md-4">
                                <label for="sectionPattern" class="form-label">Pattern</label>
                                <select class="form-select" id="sectionPattern" onchange="themeManager.updateSetting('sectionStyles', 'pattern', this.value)">
                                    <option value="none">None</option>
                                    <option value="diagonal-lines">Diagonal Lines</option>
                                    <option value="dots">Dots</option>
                                    <option value="grid">Grid</option>
                                    <option value="zigzag">Zigzag</option>
                                    <option value="crosshatch">Crosshatch</option>
                                    <option value="waves">Waves</option>
                                    <option value="honeycomb">Honeycomb</option>
                                    <option value="checkers">Checkers</option>
                                    <option value="triangles">Triangles</option>
                                    <option value="stars">Stars</option>
                                    <option value="circuit">Circuit</option>
                                    <option value="noise">Noise</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row g-3 mt-1">
                            <div class="col-md-12">
                                <label for="sectionDecoration" class="form-label">Corner Decoration - Full Emoji Library</label>
                                <select class="form-select" id="sectionDecoration" onchange="themeManager.updateSetting('sectionStyles', 'decoration', this.value)">
                                    <option value="none">None</option>
                                    <optgroup label="üåø Nature & Weather">
                                        <option value="leaf">üçÉ Leaf</option>
                                        <option value="tree">üå≤ Tree</option>
                                        <option value="flower">üå∏ Flower</option>
                                        <option value="rose">üåπ Rose</option>
                                        <option value="cactus">üåµ Cactus</option>
                                        <option value="mushroom">üçÑ Mushroom</option>
                                        <option value="sun">‚òÄÔ∏è Sun</option>
                                        <option value="moon">üåô Moon</option>
                                        <option value="star">‚≠ê Star</option>
                                        <option value="rainbow">üåà Rainbow</option>
                                        <option value="cloud">‚òÅÔ∏è Cloud</option>
                                        <option value="snow">‚ùÑÔ∏è Snow</option>
                                        <option value="fire">üî• Fire</option>
                                        <option value="lightning">‚ö° Lightning</option>
                                    </optgroup>
                                    <optgroup label="üêæ Animals">
                                        <option value="cat">üê± Cat</option>
                                        <option value="dog">üê∂ Dog</option>
                                        <option value="fox">ü¶ä Fox</option>
                                        <option value="owl">ü¶â Owl</option>
                                        <option value="butterfly">ü¶ã Butterfly</option>
                                        <option value="bee">üêù Bee</option>
                                    </optgroup>
                                    <optgroup label="üíé Gems & Objects">
                                        <option value="diamond">üíé Diamond</option>
                                        <option value="gem">üí† Gem</option>
                                        <option value="crown">üëë Crown</option>
                                        <option value="trophy">üèÜ Trophy</option>
                                        <option value="medal">üèÖ Medal</option>
                                        <option value="key">üîë Key</option>
                                        <option value="lock">üîí Lock</option>
                                    </optgroup>
                                    <optgroup label="‚öîÔ∏è Fantasy & Adventure">
                                        <option value="shield">üõ°Ô∏è Shield</option>
                                        <option value="sword">‚öîÔ∏è Sword</option>
                                        <option value="crystal">ÔøΩ Crystal Ball</option>
                                        <option value="magic">‚ú® Magic</option>
                                        <option value="wizard">üßô Wizard</option>
                                        <option value="unicorn">ü¶Ñ Unicorn</option>
                                        <option value="dragon">üêâ Dragon</option>
                                    </optgroup>
                                    <optgroup label="üöÄ Tech & Gaming">
                                        <option value="gear">‚öôÔ∏è Gear</option>
                                        <option value="circuit">üîå Circuit</option>
                                        <option value="code">üìã Code</option>
                                        <option value="data">üíæ Data</option>
                                        <option value="rocket">üöÄ Rocket</option>
                                        <option value="robot">ü§ñ Robot</option>
                                        <option value="computer">üíª Computer</option>
                                        <option value="phone">üì± Phone</option>
                                        <option value="gamepad">üéÆ Gamepad</option>
                                        <option value="wifi">üì∂ WiFi</option>
                                        <option value="battery">üîã Battery</option>
                                    </optgroup>
                                    <optgroup label="üé® Creative & Music">
                                        <option value="palette">üé® Art Palette</option>
                                        <option value="music">üéµ Music</option>
                                        <option value="camera">üì∑ Camera</option>
                                    </optgroup>
                                    <optgroup label="‚öΩ Sports & Games">
                                        <option value="target">üéØ Target</option>
                                        <option value="soccer">‚öΩ Soccer</option>
                                        <option value="basketball">üèÄ Basketball</option>
                                    </optgroup>
                                    <optgroup label="üçï Food & Drink">
                                        <option value="coffee">‚òï Coffee</option>
                                        <option value="pizza">üçï Pizza</option>
                                        <option value="cake">üéÇ Cake</option>
                                        <option value="donut">üç© Donut</option>
                                    </optgroup>
                                    <optgroup label="üòä Faces & Emotions">
                                        <option value="smile">üòä Smile</option>
                                        <option value="cool">üòé Cool</option>
                                        <option value="thinking">ü§î Thinking</option>
                                        <option value="party">ü•≥ Party</option>
                                    </optgroup>
                                    <optgroup label="‚ôæÔ∏è Symbols">
                                        <option value="heart">‚ù§Ô∏è Heart</option>
                                        <option value="peace">‚òÆÔ∏è Peace</option>
                                        <option value="yin-yang">‚òØÔ∏è Yin Yang</option>
                                        <option value="infinity">‚ôæÔ∏è Infinity</option>
                                        <option value="check">‚úÖ Check</option>
                                        <option value="warning">‚ö†Ô∏è Warning</option>
                                    </optgroup>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Custom Colors (Collapsible) -->
                    <div class="settings-section collapsible-section" id="customColorsSection">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0" style="color: var(--theme-primary, #6f42c1);">
                                <i class="fas fa-paint-brush me-2"></i>Custom Colors
                            </h5>
                            <button class="btn btn-outline-secondary btn-sm" type="button" onclick="toggleSection('customColorsSection')">
                                <i class="fas fa-chevron-down"></i>
                            </button>
                        </div>
                        
                        <div class="collapsible-content">
                            <p class="text-muted mb-3">Override default color scheme with custom colors (requires Custom theme selection)</p>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Primary Color</label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control" id="customPrimary" value="{{ custom_colors.get('primary', '#0d6efd') }}">
                                        <input type="text" class="form-control" placeholder="#0d6efd" value="{{ custom_colors.get('primary', '#0d6efd') }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Primary Hover</label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control" id="customPrimaryHover" value="{{ custom_colors.get('primary_hover', '#0b5ed7') }}">
                                        <input type="text" class="form-control" placeholder="#0b5ed7" value="{{ custom_colors.get('primary_hover', '#0b5ed7') }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Secondary Color</label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control" id="customSecondary" value="{{ custom_colors.get('secondary', '#6c757d') }}">
                                        <input type="text" class="form-control" placeholder="#6c757d" value="{{ custom_colors.get('secondary', '#6c757d') }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Success Color</label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control" id="customSuccess" value="{{ custom_colors.get('success', '#198754') }}">
                                        <input type="text" class="form-control" placeholder="#198754" value="{{ custom_colors.get('success', '#198754') }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Warning Color</label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control" id="customWarning" value="{{ custom_colors.get('warning', '#ffc107') }}">
                                        <input type="text" class="form-control" placeholder="#ffc107" value="{{ custom_colors.get('warning', '#ffc107') }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Danger Color</label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control" id="customDanger" value="{{ custom_colors.get('danger', '#dc3545') }}">
                                        <input type="text" class="form-control" placeholder="#dc3545" value="{{ custom_colors.get('danger', '#dc3545') }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Info Color</label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control" id="customInfo" value="{{ custom_colors.get('info', '#0dcaf0') }}">
                                        <input type="text" class="form-control" placeholder="#0dcaf0" value="{{ custom_colors.get('info', '#0dcaf0') }}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Custom Light Mode Colors (Collapsible) -->
                    <div class="settings-section collapsible-section" id="customLightModeSection">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0" style="color: var(--theme-primary, #6f42c1);">
                                <i class="fas fa-sun me-2"></i>Custom Light Mode Colors
                            </h5>
                            <button class="btn btn-outline-secondary btn-sm" type="button" onclick="toggleSection('customLightModeSection')">
                                <i class="fas fa-chevron-down"></i>
                            </button>
                        </div>
                        
                        <div class="collapsible-content">
                            <p class="text-muted mb-3">Customize light mode background and text colors</p>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Body Background</label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control" id="customLightBgBody" value="{{ custom_light_mode.get('bg_body', '#ffffff') }}">
                                        <input type="text" class="form-control" placeholder="#ffffff" value="{{ custom_light_mode.get('bg_body', '#ffffff') }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Card Background</label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control" id="customLightBgCard" value="{{ custom_light_mode.get('bg_card', '#ffffff') }}">
                                        <input type="text" class="form-control" placeholder="#ffffff" value="{{ custom_light_mode.get('bg_card', '#ffffff') }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Surface Background</label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control" id="customLightBgSurface" value="{{ custom_light_mode.get('bg_surface', '#f8f9fa') }}">
                                        <input type="text" class="form-control" placeholder="#f8f9fa" value="{{ custom_light_mode.get('bg_surface', '#f8f9fa') }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Text Color</label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control" id="customLightText" value="{{ custom_light_mode.get('text', '#212529') }}">
                                        <input type="text" class="form-control" placeholder="#212529" value="{{ custom_light_mode.get('text', '#212529') }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Muted Text</label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control" id="customLightTextMuted" value="{{ custom_light_mode.get('text_muted', '#6c757d') }}">
                                        <input type="text" class="form-control" placeholder="#6c757d" value="{{ custom_light_mode.get('text_muted', '#6c757d') }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Border Color</label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control" id="customLightBorder" value="{{ custom_light_mode.get('border', '#dee2e6') }}">
                                        <input type="text" class="form-control" placeholder="#dee2e6" value="{{ custom_light_mode.get('border', '#dee2e6') }}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Custom Dark Mode Colors (Collapsible) -->
                    <div class="settings-section collapsible-section" id="customDarkModeSection">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0" style="color: var(--theme-primary, #6f42c1);">
                                <i class="fas fa-moon me-2"></i>Custom Dark Mode Colors
                            </h5>
                            <button class="btn btn-outline-secondary btn-sm" type="button" onclick="toggleSection('customDarkModeSection')">
                                <i class="fas fa-chevron-down"></i>
                            </button>
                        </div>
                        
                        <div class="collapsible-content">
                            <p class="text-muted mb-3">Customize dark mode background and text colors</p>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Body Background</label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control" id="customDarkBgBody" value="{{ custom_dark_mode.get('bg_body', '#0d1117') }}">
                                        <input type="text" class="form-control" placeholder="#0d1117" value="{{ custom_dark_mode.get('bg_body', '#0d1117') }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Card Background</label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control" id="customDarkBgCard" value="{{ custom_dark_mode.get('bg_card', '#161b22') }}">
                                        <input type="text" class="form-control" placeholder="#161b22" value="{{ custom_dark_mode.get('bg_card', '#161b22') }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Surface Background</label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control" id="customDarkBgSurface" value="{{ custom_dark_mode.get('bg_surface', '#21262d') }}">
                                        <input type="text" class="form-control" placeholder="#21262d" value="{{ custom_dark_mode.get('bg_surface', '#21262d') }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Text Color</label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control" id="customDarkText" value="{{ custom_dark_mode.get('text', '#f0f6fc') }}">
                                        <input type="text" class="form-control" placeholder="#f0f6fc" value="{{ custom_dark_mode.get('text', '#f0f6fc') }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Muted Text</label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control" id="customDarkTextMuted" value="{{ custom_dark_mode.get('text_muted', '#8b949e') }}">
                                        <input type="text" class="form-control" placeholder="#8b949e" value="{{ custom_dark_mode.get('text_muted', '#8b949e') }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Border Color</label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control" id="customDarkBorder" value="{{ custom_dark_mode.get('border', '#30363d') }}">
                                        <input type="text" class="form-control" placeholder="#30363d" value="{{ custom_dark_mode.get('border', '#30363d') }}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Theme Import/Export (Collapsible) -->
                    <div class="settings-section collapsible-section collapsed" id="importExportSection">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0" style="color: var(--theme-primary, #6f42c1);">
                                <i class="fas fa-download me-2"></i>Import/Export Theme
                            </h5>
                            <button class="btn btn-outline-secondary btn-sm" type="button" onclick="toggleSection('importExportSection')">
                                <i class="fas fa-chevron-down"></i>
                            </button>
                        </div>
                        
                        <div class="collapsible-content">
                            <p class="text-muted mb-3">Export your current theme settings or import a previously saved theme</p>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <button type="button" class="btn btn-outline-primary w-100" onclick="exportTheme()">
                                        <i class="fas fa-download me-2"></i>Export Current Theme
                                    </button>
                                </div>
                                <div class="col-md-6">
                                    <button type="button" class="btn btn-outline-success w-100" onclick="document.getElementById('themeImportFile').click()">
                                        <i class="fas fa-upload me-2"></i>Import Theme File
                                    </button>
                                    <input type="file" id="themeImportFile" accept=".json" style="display: none;" onchange="importTheme(this.files[0])">
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Or paste theme JSON here:</label>
                                    <textarea class="form-control" id="themeImportText" rows="4" placeholder="Paste exported theme JSON here..."></textarea>
                                    <button type="button" class="btn btn-outline-info mt-2" onclick="importThemeFromText()">
                                        <i class="fas fa-paste me-2"></i>Import from Text
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Reset Section -->
                    <div class="settings-section">
                        <h5 class="mb-3" style="color: var(--theme-danger, #dc3545);">
                            <i class="fas fa-undo me-2"></i>Reset Theme
                        </h5>
                        <p class="text-muted mb-3">Reset all theme settings to default values</p>
                        <button type="button" class="btn btn-outline-danger" onclick="resetTheme()">
                            <i class="fas fa-undo me-2"></i>Reset to Defaults
                        </button>
                    </div>

                    <!-- Save Button -->
                    <div class="text-end">
                        <button type="button" class="btn btn-theme-primary btn-lg" onclick="saveThemeSettings()">
                            <i class="fas fa-save me-2"></i>Save Theme Settings
                        </button>
                    </div>
                </div>
            </div>

            <!-- Live Preview Panel -->
            <div class="col-lg-5">
                <div class="preview-container">
                    <h5 class="mb-3" style="color: var(--theme-primary, #6f42c1);">
                        <i class="fas fa-eye me-2"></i>Live Preview
                    </h5>
                    <p class="text-muted mb-3">Real-time preview of your theme settings</p>
                    
                    <div id="unified-preview">
                        <!-- Preview content will be generated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='theme-manager.js') }}"></script>
    <script>
        // Initialize theme manager with current settings
        document.addEventListener('DOMContentLoaded', () => {
            const initialState = {
                theme: '{{ current_theme or "default" }}',
                darkMode: {{ 'true' if dark_mode_enabled else 'false' }},
                autoDarkMode: {{ 'true' if auto_dark_mode else 'false' }},
                darkModeStart: '{{ dark_mode_start or "18:00" }}',
                darkModeEnd: '{{ dark_mode_end or "06:00" }}',
                fontSize: '{{ font_size or "normal" }}',
                highContrast: {{ 'true' if high_contrast_enabled else 'false' }},
                customColors: {{ custom_colors|tojson if custom_colors else '{}' }},
                customLightMode: {{ custom_light_mode|tojson if custom_light_mode else '{}' }},
                customDarkMode: {{ custom_dark_mode|tojson if custom_dark_mode else '{}' }},
                sectionStyles: {{ section_styles|tojson if section_styles else '{}' }}
            };
            
            themeManager.init(initialState);
            
            // Set up event listeners
            setupEventListeners();
            
            // Update UI to reflect current state
            updateUIFromState();
        });
        
        function setupEventListeners() {
            // Dark mode toggle
            document.getElementById('darkModeToggle').addEventListener('change', (e) => {
                themeManager.updateSetting('root', 'darkMode', e.target.checked);
            });
            
            // Auto dark mode toggle
            document.getElementById('autoDarkModeToggle').addEventListener('change', (e) => {
                themeManager.updateSetting('root', 'autoDarkMode', e.target.checked);
                // Show/hide time settings
                const timeSettings = document.getElementById('autoModeTimeSettings');
                timeSettings.style.display = e.target.checked ? 'block' : 'none';
                // Update time display
                if (e.target.checked) {
                    themeManager.updateTimeDisplay();
                    startTimeUpdater();
                }
            });
            
            // Dark mode time settings
            document.getElementById('darkModeStart').addEventListener('change', (e) => {
                themeManager.updateSetting('root', 'darkModeStart', e.target.value);
                themeManager.updateTimeDisplay();
            });
            
            document.getElementById('darkModeEnd').addEventListener('change', (e) => {
                themeManager.updateSetting('root', 'darkModeEnd', e.target.value);
                themeManager.updateTimeDisplay();
            });
            
            // High contrast toggle
            document.getElementById('highContrastToggle').addEventListener('change', (e) => {
                themeManager.updateSetting('root', 'highContrast', e.target.checked);
            });
            
            // Custom color inputs
            setupColorInputListeners();
        }
        
        function setupColorInputListeners() {
            // Standard custom colors with correct field names
            const customColorInputs = {
                'customPrimary': 'primary',
                'customPrimaryHover': 'primary_hover',
                'customSecondary': 'secondary',
                'customSuccess': 'success',
                'customWarning': 'warning',
                'customDanger': 'danger',
                'customInfo': 'info'
            };
            
            Object.entries(customColorInputs).forEach(([inputId, colorKey]) => {
                const colorInput = document.getElementById(inputId);
                if (colorInput) {
                    colorInput.addEventListener('change', (e) => {
                        themeManager.updateSetting('customColors', colorKey, e.target.value);
                        
                        // Update corresponding text input
                        const textInput = colorInput.nextElementSibling;
                        if (textInput) textInput.value = e.target.value;
                    });
                    
                    // Also listen to text input changes
                    const textInput = colorInput.nextElementSibling;
                    if (textInput) {
                        textInput.addEventListener('change', (e) => {
                            if (e.target.value.match(/^#[0-9A-F]{6}$/i)) {
                                colorInput.value = e.target.value;
                                themeManager.updateSetting('customColors', colorKey, e.target.value);
                            }
                        });
                    }
                }
            });
            
            // Light mode colors with correct field names
            const lightModeInputs = {
                'customLightBgBody': 'bg_body',
                'customLightBgCard': 'bg_card',
                'customLightBgSurface': 'bg_surface',
                'customLightText': 'text',
                'customLightTextMuted': 'text_muted',
                'customLightBorder': 'border'
            };
            
            Object.entries(lightModeInputs).forEach(([inputId, colorKey]) => {
                const colorInput = document.getElementById(inputId);
                if (colorInput) {
                    colorInput.addEventListener('change', (e) => {
                        themeManager.updateSetting('customLightMode', colorKey, e.target.value);
                        
                        // Update corresponding text input
                        const textInput = colorInput.nextElementSibling;
                        if (textInput) textInput.value = e.target.value;
                    });
                    
                    // Also listen to text input changes
                    const textInput = colorInput.nextElementSibling;
                    if (textInput) {
                        textInput.addEventListener('change', (e) => {
                            if (e.target.value.match(/^#[0-9A-F]{6}$/i)) {
                                colorInput.value = e.target.value;
                                themeManager.updateSetting('customLightMode', colorKey, e.target.value);
                            }
                        });
                    }
                }
            });
            
            // Dark mode colors with correct field names
            const darkModeInputs = {
                'customDarkBgBody': 'bg_body',
                'customDarkBgCard': 'bg_card',
                'customDarkBgSurface': 'bg_surface',
                'customDarkText': 'text',
                'customDarkTextMuted': 'text_muted',
                'customDarkBorder': 'border'
            };
            
            Object.entries(darkModeInputs).forEach(([inputId, colorKey]) => {
                const colorInput = document.getElementById(inputId);
                if (colorInput) {
                    colorInput.addEventListener('change', (e) => {
                        themeManager.updateSetting('customDarkMode', colorKey, e.target.value);
                        
                        // Update corresponding text input
                        const textInput = colorInput.nextElementSibling;
                        if (textInput) textInput.value = e.target.value;
                    });
                    
                    // Also listen to text input changes
                    const textInput = colorInput.nextElementSibling;
                    if (textInput) {
                        textInput.addEventListener('change', (e) => {
                            if (e.target.value.match(/^#[0-9A-F]{6}$/i)) {
                                colorInput.value = e.target.value;
                                themeManager.updateSetting('customDarkMode', colorKey, e.target.value);
                            }
                        });
                    }
                }
            });
        }
        
        // Time updater functionality
        let timeUpdateInterval;
        
        function startTimeUpdater() {
            // Clear any existing interval
            if (timeUpdateInterval) {
                clearInterval(timeUpdateInterval);
            }
            
            // Update immediately
            themeManager.updateTimeDisplay();
            
            // Update every minute
            timeUpdateInterval = setInterval(() => {
                themeManager.updateTimeDisplay();
            }, 60000);
        }
        
        function updateUIFromState() {
            // Update theme selection
            const currentTheme = themeManager.state.theme;
            document.querySelectorAll('.theme-card').forEach(card => {
                card.classList.toggle('selected', card.dataset.theme === currentTheme);
            });
            
            // Update toggle states
            document.getElementById('darkModeToggle').checked = themeManager.state.darkMode;
            document.getElementById('autoDarkModeToggle').checked = themeManager.state.autoDarkMode;
            document.getElementById('darkModeStart').value = themeManager.state.darkModeStart;
            document.getElementById('darkModeEnd').value = themeManager.state.darkModeEnd;
            
            // Show/hide time settings based on auto mode
            const timeSettings = document.getElementById('autoModeTimeSettings');
            timeSettings.style.display = themeManager.state.autoDarkMode ? 'block' : 'none';
            
            // Start time updater if auto mode is enabled
            if (themeManager.state.autoDarkMode) {
                startTimeUpdater();
            }
            
            // Update form controls
            const controls = {
                'sectionBorderStyle': themeManager.state.sectionStyles.borderStyle || 'none',
                'sectionSpacing': themeManager.state.sectionStyles.spacing || 'normal',
                'sectionBackground': themeManager.state.sectionStyles.background || 'subtle',
                'sectionAnimation': themeManager.state.sectionStyles.animation || 'none',
                'sectionEffect': themeManager.state.sectionStyles.effect || 'none',
                'sectionPattern': themeManager.state.sectionStyles.pattern || 'none',
                'sectionDecoration': themeManager.state.sectionStyles.decoration || 'none'
            };
            
            Object.entries(controls).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) element.value = value;
            });
            
            // Update color inputs
            updateColorInputs();
        }
        
        function updateColorInputs() {
            // Update custom colors with correct mapping
            const customColorMapping = {
                'primary': 'customPrimary',
                'primary_hover': 'customPrimaryHover',
                'secondary': 'customSecondary',
                'success': 'customSuccess',
                'warning': 'customWarning',
                'danger': 'customDanger',
                'info': 'customInfo'
            };
            
            Object.entries(themeManager.state.customColors).forEach(([key, value]) => {
                const inputId = customColorMapping[key];
                if (inputId) {
                    const colorInput = document.getElementById(inputId);
                    if (colorInput) {
                        colorInput.value = value;
                        const textInput = colorInput.nextElementSibling;
                        if (textInput) textInput.value = value;
                    }
                }
            });
            
            // Update light mode colors with correct mapping
            const lightModeMapping = {
                'bg_body': 'customLightBgBody',
                'bg_card': 'customLightBgCard',
                'bg_surface': 'customLightBgSurface',
                'text': 'customLightText',
                'text_muted': 'customLightTextMuted',
                'border': 'customLightBorder'
            };
            
            Object.entries(themeManager.state.customLightMode).forEach(([key, value]) => {
                const inputId = lightModeMapping[key];
                if (inputId) {
                    const colorInput = document.getElementById(inputId);
                    if (colorInput) {
                        colorInput.value = value;
                        const textInput = colorInput.nextElementSibling;
                        if (textInput) textInput.value = value;
                    }
                }
            });
            
            // Update dark mode colors with correct mapping
            const darkModeMapping = {
                'bg_body': 'customDarkBgBody',
                'bg_card': 'customDarkBgCard',
                'bg_surface': 'customDarkBgSurface',
                'text': 'customDarkText',
                'text_muted': 'customDarkTextMuted',
                'border': 'customDarkBorder'
            };
            
            Object.entries(themeManager.state.customDarkMode).forEach(([key, value]) => {
                const inputId = darkModeMapping[key];
                if (inputId) {
                    const colorInput = document.getElementById(inputId);
                    if (colorInput) {
                        colorInput.value = value;
                        const textInput = colorInput.nextElementSibling;
                        if (textInput) textInput.value = value;
                    }
                }
            });
        }
        
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const content = section.querySelector('.collapsible-content');
            const icon = section.querySelector('.fas');
            
            section.classList.toggle('collapsed');
            icon.classList.toggle('fa-chevron-down');
            icon.classList.toggle('fa-chevron-up');
        }
        
        async function saveThemeSettings() {
            const statusMsg = document.getElementById('statusMessage');
            
            try {
                const success = await themeManager.saveSettings();
                
                if (success) {
                    statusMsg.className = 'alert alert-success status-message';
                    statusMsg.textContent = 'Theme settings saved successfully!';
                } else {
                    statusMsg.className = 'alert alert-danger status-message';
                    statusMsg.textContent = 'Failed to save theme settings. Please try again.';
                }
                
                statusMsg.classList.remove('d-none');
                
                // Auto-hide after 3 seconds
                setTimeout(() => {
                    statusMsg.classList.add('d-none');
                }, 3000);
                
            } catch (error) {
                statusMsg.className = 'alert alert-danger status-message';
                statusMsg.textContent = 'An error occurred while saving. Please try again.';
                statusMsg.classList.remove('d-none');
            }
        }
        
        function exportTheme() {
            const themeData = themeManager.exportSettings();
            const blob = new Blob([themeData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `theme-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showMessage('Theme exported successfully!', 'success');
        }
        
        function importTheme(file) {
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const success = themeManager.importSettings(e.target.result);
                    if (success) {
                        updateUIFromState();
                        showMessage('Theme imported successfully!', 'success');
                    } else {
                        showMessage('Failed to import theme. Invalid file format.', 'danger');
                    }
                } catch (error) {
                    showMessage('Error importing theme: ' + error.message, 'danger');
                }
            };
            reader.readAsText(file);
        }
        
        function importThemeFromText() {
            const textArea = document.getElementById('themeImportText');
            const themeData = textArea.value.trim();
            
            if (!themeData) {
                showMessage('Please paste theme JSON data first.', 'warning');
                return;
            }
            
            try {
                const success = themeManager.importSettings(themeData);
                if (success) {
                    updateUIFromState();
                    textArea.value = '';
                    showMessage('Theme imported successfully!', 'success');
                } else {
                    showMessage('Failed to import theme. Invalid JSON format.', 'danger');
                }
            } catch (error) {
                showMessage('Error importing theme: ' + error.message, 'danger');
            }
        }
        
        function resetTheme() {
            if (confirm('Are you sure you want to reset all theme settings to defaults? This action cannot be undone.')) {
                themeManager.reset();
                updateUIFromState();
                showMessage('Theme settings reset to defaults.', 'info');
            }
        }
        
        function showMessage(message, type) {
            const statusMsg = document.getElementById('statusMessage');
            statusMsg.className = `alert alert-${type} status-message`;
            statusMsg.textContent = message;
            statusMsg.classList.remove('d-none');
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
                statusMsg.classList.add('d-none');
            }, 3000);
        }
        
        // Theme manager event listener for real-time updates
        themeManager.addEventListener('change', (category, key, value) => {
            // Update UI elements when theme manager state changes
            if (category === 'root' && key === 'theme') {
                updateUIFromState();
            }
        });
    </script>
</body>
</html>
